import{a as x,b as M,c as C}from"./chunk-YUVTMDMN.mjs";var q=/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z/,F=class{constructor(t){this.url=t;this.ws=new WebSocket(t)}ws;send(t){return Array.isArray(t)?(t.forEach(n=>this.send(n)),this):(this.ws.send(typeof t=="object"?JSON.stringify(t):t.toString()),this)}on(t,n,r){return this.addEventListener(t,n,r)}off(t,n,r){return this.ws.removeEventListener(t,n,r),this}subscribe(t,n){return this.addEventListener("message",t,n)}addEventListener(t,n,r){return this.ws.addEventListener(t,f=>{if(t==="message"){let s=f.data.toString(),i=s.charCodeAt(0),g=s.charCodeAt(s.length-1);if(i===91||i===123)try{s=JSON.parse(s,(O,p)=>{if(typeof p=="string"&&q.test(p)){let d=new Date(p);if(!Number.isNaN(d.getTime()))return d}return p})}catch{}else M(s)?s=+s:s==="true"?s=!0:s==="false"?s=!1:s==="null"?s=null:i===34&&g===34&&q.test(s)&&(s=new Date(s.substring(1,s.length-1)));n({...f,data:s})}else n(f)},r),this}removeEventListener(t,n,r){return this.off(t,n,r),this}close(){return this.ws.close(),this}};var P=["get","post","put","delete","patch","options","head","connect","subscribe"],I=["localhost","127.0.0.1","0.0.0.0"],j=typeof FileList>"u",D=e=>j?e instanceof Blob:e instanceof FileList||e instanceof File,U=e=>{if(!e)return!1;for(let t in e)if(D(e[t])||Array.isArray(e[t])&&e[t].find(D))return!0;return!1},T=e=>j?e:new Promise(t=>{let n=new FileReader;n.onload=()=>{let r=new File([n.result],e.name,{lastModified:e.lastModified,type:e.type});t(r)},n.readAsArrayBuffer(e)}),v=(e,t,n={},r={})=>{if(Array.isArray(e)){for(let f of e)if(!Array.isArray(f))r=v(f,t,n,r);else{let s=f[0];if(typeof s=="string")r[s.toLowerCase()]=f[1];else for(let[i,g]of s)r[i.toLowerCase()]=g}return r}if(!e)return r;switch(typeof e){case"function":if(e instanceof Headers)return v(e,t,n,r);let f=e(t,n);return f?v(f,t,n,r):r;case"object":if(e instanceof Headers)return e.forEach((s,i)=>{r[i.toLowerCase()]=s}),r;for(let[s,i]of Object.entries(e))r[s.toLowerCase()]=i;return r;default:return r}};async function*_(e){let t=e.body;if(!t)return;let n=t.getReader(),r=new TextDecoder;try{for(;;){let{done:f,value:s}=await n.read();if(f)break;let i=r.decode(s);yield C(i)}}finally{n.releaseLock()}}var A=(e,t,n=[],r)=>new Proxy(()=>{},{get(f,s){return A(e,t,s==="index"?n:[...n,s],r)},apply(f,s,[i,g]){if(!i||g||typeof i=="object"&&Object.keys(i).length!==1||P.includes(n.at(-1))){let O=[...n],p=O.pop(),d="/"+O.join("/"),{fetcher:N=fetch,headers:L,onRequest:h,onResponse:S,fetch:H}=t,k=p==="get"||p==="head"||p==="subscribe";L=v(L,d,g);let K=k?i?.query:g?.query,R="";if(K){let a=(w,b)=>{R+=(R?"&":"?")+`${encodeURIComponent(w)}=${encodeURIComponent(b)}`};for(let[w,b]of Object.entries(K)){if(Array.isArray(b)){for(let c of b)a(w,c);continue}a(w,`${b}`)}}if(p==="subscribe"){let a=e.replace(/^([^]+):\/\//,e.startsWith("https://")?"wss://":e.startsWith("http://")||I.find(w=>e.includes(w))?"ws://":"wss://")+d+R;return new F(a)}return(async()=>{let a={method:p?.toUpperCase(),body:i,...H,headers:L};a.headers={...L,...v(k?i?.headers:g?.headers,d,a)};let w=k&&typeof i=="object"?i.fetch:g?.fetch;if(a={...a,...w},k&&delete a.body,h){Array.isArray(h)||(h=[h]);for(let l of h){let o=await l(d,a);typeof o=="object"&&(a={...a,...o,headers:{...a.headers,...v(o.headers,d,a)}})}}if(k&&delete a.body,U(i)){let l=new FormData;for(let[o,u]of Object.entries(a.body)){if(j){l.append(o,u);continue}if(u instanceof File){l.append(o,await T(u));continue}if(u instanceof FileList){for(let m=0;m<u.length;m++)l.append(o,await T(u[m]));continue}if(Array.isArray(u)){for(let m=0;m<u.length;m++){let W=u[m];l.append(o,W instanceof File?await T(W):W)}continue}l.append(o,u)}a.body=l}else typeof i=="object"?(a.headers["content-type"]="application/json",a.body=JSON.stringify(i)):i!=null&&(a.headers["content-type"]="text/plain");if(k&&delete a.body,h){Array.isArray(h)||(h=[h]);for(let l of h){let o=await l(d,a);typeof o=="object"&&(a={...a,...o,headers:{...a.headers,...v(o.headers,d,a)}})}}let b=e+d+R,c=await(r?.handle(new Request(b,a))??N(b,a)),y=null,E=null;if(S){Array.isArray(S)||(S=[S]);for(let l of S)try{let o=await l(c.clone());if(o!=null){y=o;break}}catch(o){o instanceof x?E=o:E=new x(422,o);break}}if(y!==null)return{data:y,error:E,response:c,status:c.status,headers:c.headers};switch(c.headers.get("Content-Type")?.split(";")[0]){case"text/event-stream":y=_(c);break;case"application/json":y=await c.json();break;case"application/octet-stream":y=await c.arrayBuffer();break;case"multipart/form-data":let l=await c.formData();y={},l.forEach((o,u)=>{y[u]=o});break;default:y=await c.text().then(C)}return(c.status>=300||c.status<200)&&(E=new x(c.status,y),y=null),{data:y,error:E,response:c,status:c.status,headers:c.headers}})()}return typeof i=="object"?A(e,t,[...n,Object.values(i)[0]],r):A(e,t,n)}}),Z=(e,t={})=>typeof e=="string"?(t.keepDomain||(e.includes("://")||(e=(I.find(n=>e.includes(n))?"http://":"https://")+e),e.endsWith("/")&&(e=e.slice(0,-1))),A(e,t)):(typeof window<"u"&&console.warn("Elysia instance server found on client side, this is not recommended for security reason. Use generic type instead."),A("http://e.ly",t,[],e));export{_ as a,Z as b};
